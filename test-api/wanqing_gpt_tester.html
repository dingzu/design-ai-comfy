<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‡æ“ GPT å›¾åƒç”Ÿæˆæµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"], input[type="url"], select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus, input[type="url"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .response-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .response-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .response-content {
            background: #fff;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e1e5e9;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status-success {
            color: #28a745;
            font-weight: 600;
        }
        
        .status-error {
            color: #dc3545;
            font-weight: 600;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .info-box code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .image-preview {
            margin-top: 20px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 512px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .download-btn {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 14px;
        }

        .download-btn:hover {
            background: #218838;
        }

        .preview-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .preview-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }

        .preview-content {
            background: #fff;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }

        .preview-btn {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }

        .preview-btn:hover {
            background: #5a6268;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .button-group .btn, .button-group .preview-btn {
            flex: 1;
        }

        .usage-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .environment-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .env-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .env-btn.active {
            background: #667eea;
            color: white;
        }

        .env-btn:hover {
            background: #667eea;
            color: white;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .warning-box h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e1e5e9;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #666;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ ä¸‡æ“ GPT å›¾åƒç”Ÿæˆæµ‹è¯•å·¥å…·</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ API ä¿¡æ¯</h3>
            <p><strong>ä¸‡æ“ç½‘å…³åœ°å€:</strong></p>
            <ul>
                <li><strong>staging:</strong> <code>https://llm-gateway-staging.corp.kuaishou.com</code></li>
                <li><strong>çº¿ä¸Šå›½å†…:</strong> <code>https://llm-gateway-prod.corp.kuaishou.com</code></li>
                <li><strong>çº¿ä¸Šidc:</strong> <code>http://llm-gateway.internal</code></li>
            </ul>
            <p><strong>APIè·¯å¾„:</strong> <code>/ai-serve/v1/gpt-image-1/</code></p>
            <p><strong>å¿…éœ€å¤´ä¿¡æ¯:</strong> x-api-key, Content-Type</p>
        </div>

        <div class="warning-box">
            <h4>âš ï¸ æ³¨æ„äº‹é¡¹</h4>
            <ul>
                <li>x-api-key éœ€è¦è”ç³» @äºæ·¼ ä¸‹å‘</li>
                <li>è¯·ç¡®ä¿ç½‘ç»œå¯ä»¥è®¿é—®ä¸‡æ“ç½‘å…³åœ°å€</li>
                <li>å›¾åƒç”Ÿæˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</li>
                <li><strong>å›¾åƒç¼–è¾‘ API å‚æ•°è¯´æ˜:</strong>
                    <ul>
                        <li>size æ”¯æŒå€¼: 1024x1024, 1024x1536, 1536x1024, auto</li>
                        <li>output_format æ”¯æŒ: png, jpeg</li>
                        <li>å›¾åƒæ–‡ä»¶å»ºè®®å°äº2MB</li>
                        <li>æ”¯æŒçš„å›¾åƒæ ¼å¼: PNG, JPEG</li>
                        <li>maské®ç½©ä¸ºå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šç¼–è¾‘åŒºåŸŸ</li>
                    </ul>
                </li>
                <li><strong>API å‚æ•°è¯´æ˜:</strong>
                    <ul>
                        <li>quality æ”¯æŒå€¼: low, medium, high, auto (ä¸æ”¯æŒ standard, hd)</li>
                        <li>style å‚æ•°å·²ç§»é™¤ (APIä¸æ”¯æŒæ­¤å‚æ•°)</li>
                        <li>å‚æ•°å·²æ ¹æ®å®é™…APIæµ‹è¯•ç»“æœè°ƒæ•´</li>
                    </ul>
                </li>
                <li><strong>CORS é™åˆ¶:</strong> æµè§ˆå™¨å¯èƒ½é˜»æ­¢è·¨åŸŸè¯·æ±‚ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š
                    <ul>
                        <li>1. å¤åˆ¶ç”Ÿæˆçš„ cURL å‘½ä»¤åœ¨ç»ˆç«¯æ‰§è¡Œ</li>
                        <li>2. ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ç¦ç”¨ CORS (ä»…æµ‹è¯•ç¯å¢ƒ)</li>
                        <li>3. é€šè¿‡åç«¯æœåŠ¡ä»£ç†è¯·æ±‚</li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ”§ CORS è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h3>
            <p><strong>å¦‚æœé‡åˆ° "Failed to fetch" é”™è¯¯ï¼Œè¿™æ˜¯æµè§ˆå™¨çš„è·¨åŸŸå®‰å…¨é™åˆ¶ã€‚</strong></p>
            <p><strong>æ¨èè§£å†³æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰:</strong></p>
            <ol>
                <li><strong>ä½¿ç”¨ cURL å‘½ä»¤:</strong> ç‚¹å‡»"é¢„è§ˆè¯·æ±‚ä½“"å¤åˆ¶ cURL å‘½ä»¤åœ¨ç»ˆç«¯æ‰§è¡Œ</li>
                <li><strong>Postman å·¥å…·:</strong> å°†è¯·æ±‚å‚æ•°å¯¼å…¥ Postman è¿›è¡Œæµ‹è¯•</li>
                <li><strong>æµè§ˆå™¨æ‰©å±•:</strong> 
                    <ul>
                        <li>Chrome: å®‰è£… "CORS Unblock" æˆ– "Disable CORS" æ‰©å±•</li>
                        <li>Firefox: å®‰è£… "CORS Everywhere" æ‰©å±•</li>
                    </ul>
                </li>
                <li><strong>åç«¯ä»£ç†:</strong> é€šè¿‡è‡ªå·±çš„åç«¯æœåŠ¡ä»£ç†è¯·æ±‚åˆ°ä¸‡æ“ç½‘å…³</li>
            </ol>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="generations">å›¾åƒç”Ÿæˆ</div>
            <div class="tab" data-tab="edits">å›¾åƒç¼–è¾‘</div>
        </div>

        <!-- å›¾åƒç”Ÿæˆæ ‡ç­¾é¡µ -->
        <div class="tab-content active" id="generations">
            <form id="generationsForm">
                <div class="form-group">
                    <label>ç¯å¢ƒé€‰æ‹©:</label>
                    <div class="environment-selector">
                        <button type="button" class="env-btn active" data-env="staging">Staging</button>
                        <button type="button" class="env-btn" data-env="prod">çº¿ä¸Šå›½å†…</button>
                        <button type="button" class="env-btn" data-env="idc">çº¿ä¸ŠIDC</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="apiKey">API Key (x-api-key):</label>
                    <input type="text" id="apiKey" placeholder="è¯·è¾“å…¥ä¸‡æ“ç½‘å…³key" required>
                </div>

                <div class="form-group">
                    <label for="apiVersion">API ç‰ˆæœ¬:</label>
                    <select id="apiVersion">
                        <option value="2025-04-01-preview">2025-04-01-preview</option>
                        <option value="2024-10-01-preview">2024-10-01-preview</option>
                        <option value="2024-08-01-preview">2024-08-01-preview</option>
                        <option value="2024-06-01">2024-06-01</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="prompt">å›¾åƒæè¿° (Prompt):</label>
                    <textarea id="prompt" placeholder="è¯·è¾“å…¥å›¾åƒæè¿°ï¼Œä¾‹å¦‚ï¼šç”Ÿæˆä¸€ä¸ªå¸¦è´è¶ç»“çš„é²¸é±¼" required>ç”Ÿæˆä¸€ä¸ªå¸¦è´è¶ç»“çš„é²¸é±¼</textarea>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label for="imageCount">ç”Ÿæˆæ•°é‡ (n):</label>
                        <select id="imageCount">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="imageSize">å›¾åƒå°ºå¯¸:</label>
                        <select id="imageSize">
                            <option value="1024x1024">1024x1024</option>
                            <option value="1792x1024">1792x1024</option>
                            <option value="1024x1792">1024x1792</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quality">å›¾åƒè´¨é‡:</label>
                        <select id="quality">
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="low">Low</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="outputFormat">è¾“å‡ºæ ¼å¼:</label>
                        <select id="outputFormat">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="preview-btn" id="previewGenerationBtn">ğŸ” é¢„è§ˆè¯·æ±‚ä½“</button>
                    <button type="submit" class="btn" id="generateBtn">ğŸ¨ ç”Ÿæˆå›¾åƒ</button>
                </div>

                <!-- è¯·æ±‚ä½“é¢„è§ˆåŒºåŸŸ -->
                <div class="preview-section" id="generationPreview" style="display: none;">
                    <div class="preview-title">ğŸ“‹ è¯·æ±‚é¢„è§ˆ</div>
                    <div>
                        <strong>è¯·æ±‚URL:</strong>
                        <div class="preview-content" id="generationUrl"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>è¯·æ±‚å¤´:</strong>
                        <div class="preview-content" id="generationHeaders"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>è¯·æ±‚ä½“:</strong>
                        <div class="preview-content" id="generationPayload"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>cURL å‘½ä»¤:</strong>
                        <div class="preview-content" id="generationCurl"></div>
                    </div>
                </div>
            </form>
        </div>

        <!-- å›¾åƒç¼–è¾‘æ ‡ç­¾é¡µ -->
        <div class="tab-content" id="edits">
            <form id="editsForm">
                <div class="form-group">
                    <label>ç¯å¢ƒé€‰æ‹©:</label>
                    <div class="environment-selector">
                        <button type="button" class="env-btn active" data-env="staging">Staging</button>
                        <button type="button" class="env-btn" data-env="prod">çº¿ä¸Šå›½å†…</button>
                        <button type="button" class="env-btn" data-env="idc">çº¿ä¸ŠIDC</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="editApiKey">API Key (x-api-key):</label>
                    <input type="text" id="editApiKey" placeholder="è¯·è¾“å…¥ä¸‡æ“ç½‘å…³key" required>
                </div>

                <div class="form-group">
                    <label for="editApiVersion">API ç‰ˆæœ¬:</label>
                    <select id="editApiVersion">
                        <option value="2025-04-01-preview">2025-04-01-preview</option>
                        <option value="2024-10-01-preview">2024-10-01-preview</option>
                        <option value="2024-08-01-preview">2024-08-01-preview</option>
                        <option value="2024-06-01">2024-06-01</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editPrompt">ç¼–è¾‘æè¿° (Prompt):</label>
                    <textarea id="editPrompt" placeholder="è¯·è¾“å…¥ç¼–è¾‘è¦æ±‚ï¼Œä¾‹å¦‚ï¼šå°†èƒŒæ™¯æ”¹ä¸ºè“è‰²å¤©ç©º" required></textarea>
                </div>

                <div class="form-group">
                    <label for="imageFile">åŸå§‹å›¾åƒæ–‡ä»¶:</label>
                    <input type="file" id="imageFile" accept="image/*" required>
                </div>

                <div class="form-group">
                    <label for="maskFile">é®ç½©æ–‡ä»¶ (å¯é€‰):</label>
                    <input type="file" id="maskFile" accept="image/*">
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label for="editImageCount">ç”Ÿæˆæ•°é‡ (n):</label>
                        <select id="editImageCount">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editImageSize">å›¾åƒå°ºå¯¸:</label>
                        <select id="editImageSize">
                            <option value="1024x1024">1024x1024</option>
                            <option value="1024x1536">1024x1536</option>
                            <option value="1536x1024">1536x1024</option>
                            <option value="auto">Auto (è‡ªåŠ¨)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editOutputFormat">è¾“å‡ºæ ¼å¼:</label>
                        <select id="editOutputFormat">
                            <option value="png">PNG</option>
                            <option value="jpeg">JPEG</option>
                        </select>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="preview-btn" id="previewEditBtn">ğŸ” é¢„è§ˆè¯·æ±‚ä½“</button>
                    <button type="submit" class="btn" id="editBtn">âœï¸ ç¼–è¾‘å›¾åƒ</button>
                </div>

                <!-- è¯·æ±‚ä½“é¢„è§ˆåŒºåŸŸ -->
                <div class="preview-section" id="editPreview" style="display: none;">
                    <div class="preview-title">ğŸ“‹ è¯·æ±‚é¢„è§ˆ</div>
                    <div>
                        <strong>è¯·æ±‚URL:</strong>
                        <div class="preview-content" id="editUrl"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>è¯·æ±‚å¤´:</strong>
                        <div class="preview-content" id="editHeaders"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>è¯·æ±‚ä½“ (FormData):</strong>
                        <div class="preview-content" id="editPayload"></div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>cURL å‘½ä»¤:</strong>
                        <div class="preview-content" id="editCurl"></div>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">æ­£åœ¨ç”Ÿæˆå›¾åƒ...</p>
        </div>
        
        <div class="response-container" id="responseContainer" style="display: none;">
            <div class="response-title">ğŸ“Š å“åº”ç»“æœ</div>
            <div id="statusCode"></div>
            
            <!-- å›¾åƒé¢„è§ˆåŒºåŸŸ -->
            <div class="image-preview" id="imagePreview" style="display: none;"></div>
            
            <!-- Tokenä½¿ç”¨ä¿¡æ¯ -->
            <div class="usage-info" id="usageInfo" style="display: none;"></div>
            
            <!-- åŸå§‹å“åº”æ•°æ® -->
            <div class="response-content" id="responseContent"></div>
        </div>
    </div>

    <script>
        let currentEnv = 'staging';
        let currentTab = 'generations';

        // ç¯å¢ƒé…ç½®
        const environments = {
            staging: 'https://llm-gateway-staging.corp.kuaishou.com',
            prod: 'https://llm-gateway-prod.corp.kuaishou.com',
            idc: 'http://llm-gateway.internal'
        };

        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                
                // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(tabName).classList.add('active');
                
                currentTab = tabName;
            });
        });

        // ç¯å¢ƒé€‰æ‹©
        document.querySelectorAll('.environment-selector').forEach(selector => {
            selector.addEventListener('click', function(e) {
                if (e.target.classList.contains('env-btn')) {
                    // æ›´æ–°åŒä¸€ç»„å†…çš„æŒ‰é’®çŠ¶æ€
                    selector.querySelectorAll('.env-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    currentEnv = e.target.dataset.env;
                }
            });
        });

        // é¢„è§ˆå›¾åƒç”Ÿæˆè¯·æ±‚ä½“
        document.getElementById('previewGenerationBtn').addEventListener('click', function() {
            const apiKey = document.getElementById('apiKey').value;
            const apiVersion = document.getElementById('apiVersion').value;
            const prompt = document.getElementById('prompt').value;
            const imageCount = parseInt(document.getElementById('imageCount').value);
            const imageSize = document.getElementById('imageSize').value;
            const quality = document.getElementById('quality').value;
            const outputFormat = document.getElementById('outputFormat').value;
            
            if (!apiKey) {
                alert('è¯·å…ˆå¡«å†™ API Key');
                return;
            }
            
            if (!prompt) {
                alert('è¯·å…ˆå¡«å†™å›¾åƒæè¿°');
                return;
            }
            
            const url = `${environments[currentEnv]}/ai-serve/v1/gpt-image-1/generations?api-version=${apiVersion}`;
            
            const payload = {
                prompt: prompt,
                n: imageCount,
                size: imageSize,
                quality: quality,
                output_format: outputFormat
            };
            
            const headers = {
                'x-api-key': apiKey,
                'Content-Type': 'application/json'
            };
            
            // æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('generationUrl').textContent = url;
            document.getElementById('generationHeaders').textContent = JSON.stringify(headers, null, 2);
            document.getElementById('generationPayload').textContent = JSON.stringify(payload, null, 2);
            
            // ç”Ÿæˆ cURL å‘½ä»¤
            const curlCommand = generateCurlCommand(url, 'POST', headers, payload);
            document.getElementById('generationCurl').textContent = curlCommand;
            
            document.getElementById('generationPreview').style.display = 'block';
        });

        // é¢„è§ˆå›¾åƒç¼–è¾‘è¯·æ±‚ä½“
        document.getElementById('previewEditBtn').addEventListener('click', function() {
            const apiKey = document.getElementById('editApiKey').value;
            const apiVersion = document.getElementById('editApiVersion').value;
            const prompt = document.getElementById('editPrompt').value;
            const imageCount = parseInt(document.getElementById('editImageCount').value);
            const imageSize = document.getElementById('editImageSize').value;
            const outputFormat = document.getElementById('editOutputFormat').value;
            const imageFile = document.getElementById('imageFile').files[0];
            const maskFile = document.getElementById('maskFile').files[0];
            
            if (!apiKey) {
                alert('è¯·å…ˆå¡«å†™ API Key');
                return;
            }
            
            if (!prompt) {
                alert('è¯·å…ˆå¡«å†™ç¼–è¾‘æè¿°');
                return;
            }
            
            if (!imageFile) {
                alert('è¯·å…ˆé€‰æ‹©åŸå§‹å›¾åƒæ–‡ä»¶');
                return;
            }
            
            const url = `${environments[currentEnv]}/ai-serve/v1/gpt-image-1/edits?api-version=${apiVersion}`;
            
            const headers = {
                'x-api-key': apiKey,
                'Content-Type': 'multipart/form-data'
            };
            
            // æ„å»ºFormDataé¢„è§ˆä¿¡æ¯
            let formDataPreview = `prompt: ${prompt}\n`;
            formDataPreview += `n: ${imageCount}\n`;
            formDataPreview += `size: ${imageSize}\n`;
            formDataPreview += `output_format: ${outputFormat}\n`;
            formDataPreview += `image: ${imageFile.name} (${(imageFile.size / 1024).toFixed(2)} KB)\n`;
            
            if (maskFile) {
                formDataPreview += `mask: ${maskFile.name} (${(maskFile.size / 1024).toFixed(2)} KB)`;
            } else {
                formDataPreview += `mask: æœªé€‰æ‹©`;
            }
            
            // æ˜¾ç¤ºé¢„è§ˆ
            document.getElementById('editUrl').textContent = url;
            document.getElementById('editHeaders').textContent = JSON.stringify(headers, null, 2);
            document.getElementById('editPayload').textContent = formDataPreview;
            
            // ç”Ÿæˆ cURL å‘½ä»¤ (FormData)
            const curlCommand = generateCurlFormDataCommand(url, apiKey, {
                prompt: prompt,
                n: imageCount,
                size: imageSize,
                output_format: outputFormat,
                image: imageFile,
                mask: maskFile
            });
            document.getElementById('editCurl').textContent = curlCommand;
            
            document.getElementById('editPreview').style.display = 'block';
        });

        // å›¾åƒç”Ÿæˆè¡¨å•æäº¤
        document.getElementById('generationsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const apiKey = document.getElementById('apiKey').value;
            const apiVersion = document.getElementById('apiVersion').value;
            const prompt = document.getElementById('prompt').value;
            const imageCount = parseInt(document.getElementById('imageCount').value);
            const imageSize = document.getElementById('imageSize').value;
            const quality = document.getElementById('quality').value;
            const outputFormat = document.getElementById('outputFormat').value;
            
            const url = `${environments[currentEnv]}/ai-serve/v1/gpt-image-1/generations?api-version=${apiVersion}`;
            
            const payload = {
                prompt: prompt,
                n: imageCount,
                size: imageSize,
                quality: quality,
                output_format: outputFormat
            };
            
            await sendRequest(url, 'POST', apiKey, payload, 'æ­£åœ¨ç”Ÿæˆå›¾åƒ...');
        });

        // å›¾åƒç¼–è¾‘è¡¨å•æäº¤
        document.getElementById('editsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const apiKey = document.getElementById('editApiKey').value;
            const apiVersion = document.getElementById('editApiVersion').value;
            const prompt = document.getElementById('editPrompt').value;
            const imageCount = parseInt(document.getElementById('editImageCount').value);
            const imageSize = document.getElementById('editImageSize').value;
            const outputFormat = document.getElementById('editOutputFormat').value;
            const imageFile = document.getElementById('imageFile').files[0];
            const maskFile = document.getElementById('maskFile').files[0];
            
            if (!imageFile) {
                alert('è¯·é€‰æ‹©åŸå§‹å›¾åƒæ–‡ä»¶');
                return;
            }
            
            const url = `${environments[currentEnv]}/ai-serve/v1/gpt-image-1/edits?api-version=${apiVersion}`;
            
            // åˆ›å»ºFormData
            const formData = new FormData();
            formData.append('prompt', prompt);
            formData.append('n', imageCount.toString());
            formData.append('size', imageSize);
            formData.append('output_format', outputFormat);
            formData.append('image', imageFile);
            
            if (maskFile) {
                formData.append('mask', maskFile);
            }
            
            await sendRequestFormData(url, apiKey, formData, 'æ­£åœ¨ç¼–è¾‘å›¾åƒ...');
        });

        async function sendRequest(url, method, apiKey, payload, loadingText) {
            const submitBtn = document.getElementById(currentTab === 'generations' ? 'generateBtn' : 'editBtn');
            const loading = document.getElementById('loading');
            const responseContainer = document.getElementById('responseContainer');
            const statusCode = document.getElementById('statusCode');
            const responseContent = document.getElementById('responseContent');
            const imagePreview = document.getElementById('imagePreview');
            const usageInfo = document.getElementById('usageInfo');
            const loadingTextElement = document.getElementById('loadingText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            loading.style.display = 'block';
            loadingTextElement.textContent = loadingText;
            responseContainer.style.display = 'none';
            
            try {
                console.log('å‘é€è¯·æ±‚åˆ°:', url);
                console.log('è¯·æ±‚å¤´:', {
                    'x-api-key': apiKey,
                    'Content-Type': 'application/json'
                });
                console.log('è¯·æ±‚ä½“:', payload);
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'x-api-key': apiKey,
                        'Content-Type': 'application/json',
                        'User-Agent': 'WanQing-GPT-Tester/1.0'
                    },
                    body: JSON.stringify(payload),
                    mode: 'cors',
                    credentials: 'omit',
                    cache: 'no-cache'
                });
                
                const responseText = await response.text();
                
                try {
                    const responseData = JSON.parse(responseText);
                    responseContent.textContent = JSON.stringify(responseData, null, 2);
                    
                    // æ˜¾ç¤ºçŠ¶æ€ç 
                    if (response.ok) {
                        statusCode.innerHTML = `<span class="status-success">âœ… çŠ¶æ€ç : ${response.status} ${response.statusText}</span>`;
                        
                        // å¤„ç†å›¾åƒæ•°æ®
                        if (responseData.data && Array.isArray(responseData.data) && responseData.data.length > 0) {
                            displayImages(responseData.data);
                            
                            // æ˜¾ç¤ºä½¿ç”¨æƒ…å†µ
                            if (responseData.usage) {
                                displayUsageInfo(responseData.usage);
                            }
                        }
                    } else {
                        statusCode.innerHTML = `<span class="status-error">âŒ çŠ¶æ€ç : ${response.status} ${response.statusText}</span>`;
                    }
                    
                } catch (jsonError) {
                    responseContent.textContent = responseText;
                    statusCode.innerHTML = `<span class="status-error">âŒ å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼</span>`;
                    imagePreview.style.display = 'none';
                    usageInfo.style.display = 'none';
                }
                
                responseContainer.style.display = 'block';
                
            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);
                statusCode.innerHTML = `<span class="status-error">âŒ è¯·æ±‚å¤±è´¥</span>`;
                
                let errorMessage = `é”™è¯¯ä¿¡æ¯: ${error.message}\n\n`;
                
                // æ£€æµ‹ CORS é”™è¯¯
                if (error.message.includes('fetch') || error.message.includes('CORS') || error.message.includes('blocked')) {
                    errorMessage += `ğŸš« æ£€æµ‹åˆ° CORS è·¨åŸŸé™åˆ¶é—®é¢˜ï¼\n\n`;
                    errorMessage += `è§£å†³æ–¹æ¡ˆ:\n`;
                    errorMessage += `1. ã€æ¨èã€‘å¤åˆ¶ä¸‹æ–¹ç”Ÿæˆçš„ cURL å‘½ä»¤åœ¨ç»ˆç«¯æ‰§è¡Œ\n`;
                    errorMessage += `2. å®‰è£…æµè§ˆå™¨ CORS æ‰©å±• (ä»…æµ‹è¯•ç¯å¢ƒ):\n`;
                    errorMessage += `   - Chrome: "CORS Unblock" æˆ– "Disable CORS"\n`;
                    errorMessage += `   - Firefox: "CORS Everywhere"\n`;
                    errorMessage += `3. é€šè¿‡åç«¯æœåŠ¡ä»£ç†è¯·æ±‚\n`;
                    errorMessage += `4. ä½¿ç”¨ Postman æˆ–å…¶ä»– API æµ‹è¯•å·¥å…·\n\n`;
                } else {
                    errorMessage += `å¯èƒ½çš„åŸå› :\n`;
                    errorMessage += `1. ç½‘ç»œè¿æ¥é—®é¢˜\n`;
                    errorMessage += `2. API æœåŠ¡å™¨ä¸å¯ç”¨\n`;
                    errorMessage += `3. è®¤è¯ä¿¡æ¯é”™è¯¯ (x-api-key)\n`;
                    errorMessage += `4. ä¸‡æ“ç½‘å…³keyæ— æ•ˆ\n`;
                    errorMessage += `5. å›¾åƒæ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ\n\n`;
                    errorMessage += `å»ºè®®:\n`;
                    errorMessage += `- æ£€æŸ¥ç½‘ç»œè¿æ¥\n`;
                    errorMessage += `- ç¡®è®¤ API URL æ­£ç¡®\n`;
                    errorMessage += `- éªŒè¯ x-api-key æ˜¯å¦æœ‰æ•ˆ\n`;
                    errorMessage += `- ç¡®ä¿å›¾åƒæ–‡ä»¶æ˜¯PNGæˆ–JPEGæ ¼å¼\n`;
                    errorMessage += `- è”ç³» @äºæ·¼ è·å–æœ‰æ•ˆçš„ä¸‡æ“ç½‘å…³key\n`;
                }
                
                responseContent.textContent = errorMessage;
                responseContainer.style.display = 'block';
                imagePreview.style.display = 'none';
                usageInfo.style.display = 'none';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        async function sendRequestFormData(url, apiKey, formData, loadingText) {
            const submitBtn = document.getElementById('editBtn');
            const loading = document.getElementById('loading');
            const responseContainer = document.getElementById('responseContainer');
            const statusCode = document.getElementById('statusCode');
            const responseContent = document.getElementById('responseContent');
            const imagePreview = document.getElementById('imagePreview');
            const usageInfo = document.getElementById('usageInfo');
            const loadingTextElement = document.getElementById('loadingText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            loading.style.display = 'block';
            loadingTextElement.textContent = loadingText;
            responseContainer.style.display = 'none';
            
            try {
                console.log('å‘é€FormDataè¯·æ±‚åˆ°:', url);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'x-api-key': apiKey
                        // æ³¨æ„ï¼šä¸è¦è®¾ç½®Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®multipart/form-dataè¾¹ç•Œ
                    },
                    body: formData,
                    mode: 'cors',
                    credentials: 'omit',
                    cache: 'no-cache'
                });
                
                const responseText = await response.text();
                
                try {
                    const responseData = JSON.parse(responseText);
                    responseContent.textContent = JSON.stringify(responseData, null, 2);
                    
                    // æ˜¾ç¤ºçŠ¶æ€ç 
                    if (response.ok) {
                        statusCode.innerHTML = `<span class="status-success">âœ… çŠ¶æ€ç : ${response.status} ${response.statusText}</span>`;
                        
                        // å¤„ç†å›¾åƒæ•°æ®
                        if (responseData.data && Array.isArray(responseData.data) && responseData.data.length > 0) {
                            displayImages(responseData.data);
                            
                            // æ˜¾ç¤ºä½¿ç”¨æƒ…å†µ
                            if (responseData.usage) {
                                displayUsageInfo(responseData.usage);
                            }
                        }
                    } else {
                        statusCode.innerHTML = `<span class="status-error">âŒ çŠ¶æ€ç : ${response.status} ${response.statusText}</span>`;
                    }
                    
                } catch (jsonError) {
                    responseContent.textContent = responseText;
                    statusCode.innerHTML = `<span class="status-error">âŒ å“åº”ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼</span>`;
                    imagePreview.style.display = 'none';
                    usageInfo.style.display = 'none';
                }
                
                responseContainer.style.display = 'block';
                
            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);
                statusCode.innerHTML = `<span class="status-error">âŒ è¯·æ±‚å¤±è´¥</span>`;
                
                let errorMessage = `é”™è¯¯ä¿¡æ¯: ${error.message}\n\n`;
                
                // æ£€æµ‹ CORS é”™è¯¯
                if (error.message.includes('fetch') || error.message.includes('CORS') || error.message.includes('blocked')) {
                    errorMessage += `ğŸš« æ£€æµ‹åˆ° CORS è·¨åŸŸé™åˆ¶é—®é¢˜ï¼\n\n`;
                    errorMessage += `è§£å†³æ–¹æ¡ˆ:\n`;
                    errorMessage += `1. ã€æ¨èã€‘å¤åˆ¶ä¸‹æ–¹ç”Ÿæˆçš„ cURL å‘½ä»¤åœ¨ç»ˆç«¯æ‰§è¡Œ\n`;
                    errorMessage += `2. å®‰è£…æµè§ˆå™¨ CORS æ‰©å±• (ä»…æµ‹è¯•ç¯å¢ƒ):\n`;
                    errorMessage += `   - Chrome: "CORS Unblock" æˆ– "Disable CORS"\n`;
                    errorMessage += `   - Firefox: "CORS Everywhere"\n`;
                    errorMessage += `3. é€šè¿‡åç«¯æœåŠ¡ä»£ç†è¯·æ±‚\n`;
                    errorMessage += `4. ä½¿ç”¨ Postman æˆ–å…¶ä»– API æµ‹è¯•å·¥å…·\n\n`;
                } else {
                    errorMessage += `å¯èƒ½çš„åŸå› :\n`;
                    errorMessage += `1. ç½‘ç»œè¿æ¥é—®é¢˜\n`;
                    errorMessage += `2. API æœåŠ¡å™¨ä¸å¯ç”¨\n`;
                    errorMessage += `3. è®¤è¯ä¿¡æ¯é”™è¯¯ (x-api-key)\n`;
                    errorMessage += `4. ä¸‡æ“ç½‘å…³keyæ— æ•ˆ\n`;
                    errorMessage += `5. å›¾åƒæ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ\n\n`;
                    errorMessage += `å»ºè®®:\n`;
                    errorMessage += `- æ£€æŸ¥ç½‘ç»œè¿æ¥\n`;
                    errorMessage += `- ç¡®è®¤ API URL æ­£ç¡®\n`;
                    errorMessage += `- éªŒè¯ x-api-key æ˜¯å¦æœ‰æ•ˆ\n`;
                    errorMessage += `- ç¡®ä¿å›¾åƒæ–‡ä»¶æ˜¯PNGæˆ–JPEGæ ¼å¼\n`;
                    errorMessage += `- è”ç³» @äºæ·¼ è·å–æœ‰æ•ˆçš„ä¸‡æ“ç½‘å…³key\n`;
                }
                
                responseContent.textContent = errorMessage;
                responseContainer.style.display = 'block';
                imagePreview.style.display = 'none';
                usageInfo.style.display = 'none';
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function displayImages(imageData) {
            const imagePreview = document.getElementById('imagePreview');
            let previewHtml = '<h3>ğŸ–¼ï¸ ç”Ÿæˆçš„å›¾åƒ:</h3>';
            
            imageData.forEach((item, index) => {
                if (item.b64_json) {
                    const imageSrc = `data:image/png;base64,${item.b64_json}`;
                    const filename = `generated_image_${index + 1}_${Date.now()}.png`;
                    
                    previewHtml += `
                        <div style="margin: 20px 0; padding: 15px; border: 1px solid #e1e5e9; border-radius: 8px;">
                            <h4>å›¾åƒ ${index + 1}</h4>
                            <img src="${imageSrc}" alt="Generated Image ${index + 1}" style="max-width: 100%; max-height: 512px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <br>
                            <a href="${imageSrc}" download="${filename}" class="download-btn">ğŸ“¥ ä¸‹è½½å›¾åƒ</a>
                        </div>
                    `;
                } else if (item.url) {
                    previewHtml += `
                        <div style="margin: 20px 0; padding: 15px; border: 1px solid #e1e5e9; border-radius: 8px;">
                            <h4>å›¾åƒ ${index + 1}</h4>
                            <img src="${item.url}" alt="Generated Image ${index + 1}" style="max-width: 100%; max-height: 512px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <br>
                            <a href="${item.url}" target="_blank" class="download-btn">ğŸ”— æŸ¥çœ‹åŸå›¾</a>
                        </div>
                    `;
                }
            });
            
            imagePreview.innerHTML = previewHtml;
            imagePreview.style.display = 'block';
        }

        function displayUsageInfo(usage) {
            const usageInfo = document.getElementById('usageInfo');
            usageInfo.innerHTML = `
                <h4>ğŸ“Š Token ä½¿ç”¨æƒ…å†µ:</h4>
                <p><strong>è¾“å…¥ Token:</strong> ${usage.input_tokens || 0}</p>
                <p><strong>è¾“å‡º Token:</strong> ${usage.output_tokens || 0}</p>
                <p><strong>æ€»è®¡ Token:</strong> ${(usage.input_tokens || 0) + (usage.output_tokens || 0)}</p>
            `;
            usageInfo.style.display = 'block';
        }

        // ç”Ÿæˆ cURL å‘½ä»¤ (JSON æ•°æ®)
        function generateCurlCommand(url, method, headers, payload) {
            let curl = `curl -X ${method} \\\n`;
            curl += `  '${url}' \\\n`;
            
            // æ·»åŠ è¯·æ±‚å¤´
            for (const [key, value] of Object.entries(headers)) {
                curl += `  -H '${key}: ${value}' \\\n`;
            }
            
            // æ·»åŠ è¯·æ±‚ä½“
            if (payload && Object.keys(payload).length > 0) {
                const jsonData = JSON.stringify(payload);
                // è½¬ä¹‰å•å¼•å·ä»¥é¿å…å‘½ä»¤è¡Œé—®é¢˜
                const escapedData = jsonData.replace(/'/g, "'\"'\"'");
                curl += `  -d '${escapedData}'`;
            }
            
            return curl;
        }

        // ç”Ÿæˆ cURL å‘½ä»¤ (FormData)
        function generateCurlFormDataCommand(url, apiKey, formFields) {
            let curl = `curl -X POST \\\n`;
            curl += `  '${url}' \\\n`;
            curl += `  -H 'x-api-key: ${apiKey}' \\\n`;
            
            // æ·»åŠ è¡¨å•å­—æ®µ
            for (const [key, value] of Object.entries(formFields)) {
                if (key === 'image' || key === 'mask') {
                    if (value && value.name) {
                        curl += `  -F '${key}=@${value.name}' \\\n`;
                    }
                } else if (value !== null && value !== undefined && value !== '') {
                    curl += `  -F '${key}=${value}' \\\n`;
                }
            }
            
            // ç§»é™¤æœ€åçš„åæ–œæ å’Œæ¢è¡Œ
            curl = curl.replace(/\s\\\n$/, '');
            
            curl += `\n\n# æ³¨æ„: è¯·å°† @filename æ›¿æ¢ä¸ºå®é™…çš„æ–‡ä»¶è·¯å¾„\n`;
            curl += `# ä¾‹å¦‚: -F 'image=@/path/to/your/image.png'`;
            
            return curl;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„æç¤º
        window.addEventListener('load', function() {
            console.log('ä¸‡æ“ GPT å›¾åƒç”Ÿæˆæµ‹è¯•å·¥å…·å·²åŠ è½½å®Œæˆ');
            console.log('è¯·è”ç³» @äºæ·¼ è·å–æœ‰æ•ˆçš„ä¸‡æ“ç½‘å…³key');
        });
    </script>
</body>
</html>